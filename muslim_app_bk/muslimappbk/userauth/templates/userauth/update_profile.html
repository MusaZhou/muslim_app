{% load static %}
{% load widget_tweaks %}
<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
  <title>Update Profile</title>
  <style>
    #loader {
      transition: all .3s ease-in-out;
      opacity: 1;
      visibility: visible;
      position: fixed;
      height: 100vh;
      width: 100%;
      background: #fff;
      z-index: 90000
    }

    #loader.fadeOut {
      opacity: 0;
      visibility: hidden
    }

    .spinner {
      width: 40px;
      height: 40px;
      position: absolute;
      top: calc(50% - 20px);
      left: calc(50% - 20px);
      background-color: #333;
      border-radius: 100%;
      -webkit-animation: sk-scaleout 1s infinite ease-in-out;
      animation: sk-scaleout 1s infinite ease-in-out
    }

    @-webkit-keyframes sk-scaleout {
      0% {
        -webkit-transform: scale(0)
      }
      100% {
        -webkit-transform: scale(1);
        opacity: 0
      }
    }

    @keyframes sk-scaleout {
      0% {
        -webkit-transform: scale(0);
        transform: scale(0)
      }
      100% {
        -webkit-transform: scale(1);
        transform: scale(1);
        opacity: 0
      }
    }
  </style>
  <link href="{% static "management/style.css" %}" rel="stylesheet">
</head>

<body class="app">
  <div id="loader">
    <div class="spinner"></div>
  </div>
  <script>
    window.addEventListener('load', () => {
      const loader = document.getElementById('loader');
      setTimeout(() => {
        loader.classList.add('fadeOut');
      }, 300);
    });
  </script>
  <div class="peers ai-s fxw-nw h-100vh">
    <div class="peer peer-greed h-100 pos-r bgr-n bgpX-c bgpY-c bgsz-cv" style="background-image:url({% static "management/images/bg.jpg" %})">
      <div class="pos-a centerXY">
        <div class="bgc-white bdrs-50p pos-r" style="width:120px;height:120px"><img class="pos-a centerXY" src="{% static "management/images/logo.png" %}" alt=""></div>
      </div>
    </div>
    <div class="col-12 col-md-4 peer pX-40 pY-80 h-100 bgc-white scrollable pos-r" style="min-width:320px">
      <h4 class="fw-300 c-grey-900 mB-40">Profile</h4>
      <form action="{% url 'userauth:update_profile' %}" method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        {% if userProfileForm.errors %}
        <div class="alert alert-danger" role="alert">
          {% for error in userProfileForm.errors %}
            {{ error }}
          {% endfor %}
        </div>
          {% endif %}
          {% if userProfileForm.non_field_errors %}
            <div class="alert alert-danger" role="alert">
              {% for error in userProfileForm.non_field_errors %}
                {{ error }}
              {% endfor %}
            </div>
          {% endif %}

          {% for hidden_field in userProfileForm.hidden_fields %}
           {% if hidden_field.errors %}
             <div class="alert alert-danger" role="alert">
               {% for error in hidden_field.errors %}
                 {{ hidden_field.name }}: {{ error }}
               {% endfor %}
             </div>
           {% endif %}
          {% endfor %}
        <div class="form-group">
            <label class="text-normal text-dark">{{ userProfileForm.nick_name.label }}</label>
            {% render_field userProfileForm.nick_name class="form-control"%}
            {% if userProfileForm.username.errors %}
                <div class="invalid-feedback d-block">
                {{ userProfileForm.username.errors }}
                </div>
            {% endif %}
        </div>
        <div class="form-group">
            <label class="text-normal text-dark">{{ userProfileForm.email.label }}</label> 
            {% render_field userProfileForm.email class="form-control" %}
            {% if userProfileForm.email.errors %}
                <div class="invalid-feedback d-block">
                {{ userProfileForm.email.errors }}
                </div>
            {% endif %}
        </div>
        <div class="form-group">
            <label class="text-normal text-dark">{{ userProfileForm.gender.label }}</label> 
            {% render_field userProfileForm.gender class="form-control" %}
            {% if userProfileForm.gender.errors %}
                <div class="invalid-feedback d-block">
                {{ userProfileForm.gender.errors }}
                </div>
            {% endif %}
        </div>from djan
        <div class="form-group">
            <label class="text-normal text-dark">{{ userProfileForm.date_of_birth.label }}</label> 
            {% render_field userProfileForm.date_of_birth class="form-control" %}
            {% if userProfileForm.date_of_birth.errors %}
                <div class="invalid-feedback d-block">
                {{ userProfileForm.date_of_birth.errors }}
                </div>
            {% endif %}
        </div>
        <div class="form-group">
            <button type="button" class="btn btn-primary avatar-btn">Broswer Avatar</button>
            <div id="avatar_widget_div" style="display:none">
                {% render_field userProfileForm.avatar id="avatar_input" %}
            </div>
            {% if userProfileForm.avatar.errors %}
                <div class="invalid-feedback d-block">
                {{ userProfileForm.avatar.errors }}
                </div>
            {% endif %}
            {% if userProfileForm.instance.avatar.url is not None %}
            <img id="avatar_img" src="{{ userProfileForm.instance.avatar.url }}" width="50px" height="50px"/>
            {% else %}
            <img id="avatar_img" src="{% static 'management/images/mobile.png' %}" width="50px" height="50px"/>
            {% endif %}
            {% if userProfileForm.avatar.errors %}
                <div class="invalid-feedback d-block">
                {{ userCreationForm.avatar.errors }}
                </div>
            {% endif %}
        </div>
        <div class="form-group"><button class="btn btn-primary">Update</button></div>
      </form>
    </div>
  </div>
  <script type="text/javascript" src="{% static "management/jquery-3.3.1.min.js" %}"></script>
  <script type="text/javascript" src="{% static "management/vendor.js" %}"></script>
  <script type="text/javascript" src="{% static "management/bundle.js" %}"></script>
</body>
<script>

$(function(){
    $('.avatar-btn').click(function(){
    	$('#avatar_input').click();
    });
    
    $('#avatar_input').change(function(){
    	//$(this).siblings(':checkbox').prop('checked', true);
        var file = this.files[0];
        displayImage(file, $('#avatar_img'));
    });
})

 function displayImage(file, imgEle){
    var reader = new FileReader();
    reader.onload = function(e) {
      // Set the img src property using the data URL.
      imgEle.prop('src', reader.result);
    }

    reader.readAsDataURL(file);
  }
</script>
</html>
